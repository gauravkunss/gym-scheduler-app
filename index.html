<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Gym Scheduler</title>
    
    <!-- App Icon - Calendar with Dumbbell -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect x='10' y='15' width='80' height='70' rx='8' fill='%232563eb' stroke='%231e40af' stroke-width='3'/%3E%3Crect x='15' y='10' width='70' height='15' rx='5' fill='%231e293b'/%3E%3Crect x='20' y='30' width='60' height='50' rx='5' fill='%23f1f5f9'/%3E%3Crect x='23' y='5' width='8' height='15' rx='4' fill='%232563eb'/%3E%3Crect x='69' y='5' width='8' height='15' rx='4' fill='%232563eb'/%3E%3Cg transform='translate(50,55)'%3E%3Crect x='-15' y='-3' width='30' height='6' rx='1' fill='%231e293b'/%3E%3Crect x='-20' y='-8' width='5' height='16' rx='2' fill='%231e293b'/%3E%3Crect x='15' y='-8' width='5' height='16' rx='2' fill='%231e293b'/%3E%3Ccircle cx='-18' cy='-10' r='3' fill='%231e293b'/%3E%3Ccircle cx='-18' cy='10' r='3' fill='%231e293b'/%3E%3Ccircle cx='18' cy='-10' r='3' fill='%231e293b'/%3E%3Ccircle cx='18' cy='10' r='3' fill='%231e293b'/%3E%3C/g%3E%3C/svg%3E" />
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect x='10' y='15' width='80' height='70' rx='8' fill='%232563eb' stroke='%231e40af' stroke-width='3'/%3E%3Crect x='15' y='10' width='70' height='15' rx='5' fill='%231e293b'/%3E%3Crect x='20' y='30' width='60' height='50' rx='5' fill='%23f1f5f9'/%3E%3Crect x='23' y='5' width='8' height='15' rx='4' fill='%232563eb'/%3E%3Crect x='69' y='5' width='8' height='15' rx='4' fill='%232563eb'/%3E%3Cg transform='translate(50,55)'%3E%3Crect x='-15' y='-3' width='30' height='6' rx='1' fill='%231e293b'/%3E%3Crect x='-20' y='-8' width='5' height='16' rx='2' fill='%231e293b'/%3E%3Crect x='15' y='-8' width='5' height='16' rx='2' fill='%231e293b'/%3E%3Ccircle cx='-18' cy='-10' r='3' fill='%231e293b'/%3E%3Ccircle cx='-18' cy='10' r='3' fill='%231e293b'/%3E%3Ccircle cx='18' cy='-10' r='3' fill='%231e293b'/%3E%3Ccircle cx='18' cy='10' r='3' fill='%231e293b'/%3E%3C/g%3E%3C/svg%3E" />
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            margin: 0; 
            padding: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background-color: #000000;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
        }
        
        #root {
            min-height: 100vh;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }
        
        .safe-top {
            padding-top: max(60px, calc(env(safe-area-inset-top) + 40px));
        }
        
        /* Custom scrollbar for webkit browsers */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #404040;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Prevent text selection on buttons */
        button {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Input focus styles */
        input:focus, select:focus {
            outline: none;
            ring: 2px;
            ring-color: #3b82f6;
        }
        
        /* Smooth transitions */
        * {
            transition: background-color 0.2s ease;
        }
        
        /* Loading animation */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #ffffff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // SVG Icons - All white for dark theme
        const Dumbbell = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M14.4 14.4 9.6 9.6"/>
                <path d="M18.657 21.485a2 2 0 1 1-2.829-2.828l-1.767 1.768a2 2 0 1 1-2.829-2.829l6.364-6.364a2 2 0 1 1 2.829 2.829l-1.768 1.767a2 2 0 1 1 2.828 2.829z"/>
                <path d="m21.5 21.5-1.4-1.4"/>
                <path d="M3.9 3.9 2.5 2.5"/>
                <path d="M6.404 12.768a2 2 0 1 1-2.829-2.829l1.768-1.767a2 2 0 1 1-2.828-2.829l2.828-2.828a2 2 0 1 1 2.829 2.828l1.767-1.768a2 2 0 1 1 2.829 2.829z"/>
            </svg>
        );
        
        const Plus = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M5 12h14"/>
                <path d="M12 5v14"/>
            </svg>
        );
        
        const Trash2 = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M3 6h18"/>
                <path d="m19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                <line x1="10" x2="10" y1="11" y2="17"/>
                <line x1="14" x2="14" y1="11" y2="17"/>
            </svg>
        );
        
        const Calendar = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect width="18" height="18" x="3" y="4" rx="2" ry="2"/>
                <line x1="16" x2="16" y1="2" y2="6"/>
                <line x1="8" x2="8" y1="2" y2="6"/>
                <line x1="3" x2="21" y1="10" y2="10"/>
            </svg>
        );
        
        const Download = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" x2="12" y1="15" y2="3"/>
            </svg>
        );
        
        const CheckCircle = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#10b981" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
        );
        
        const XCircle = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#ef4444" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <path d="m15 9-6 6"/>
                <path d="m9 9 6 6"/>
            </svg>
        );

        // Exercise Database
        const bodyPartExercises = {
          'Chest': ['Barbell Flat Bench Press', 'Barbell Incline Bench Press', 'Barbell Decline Bench Press', 'Dumbbell Flat Bench Press', 'Dumbbell Incline Bench Press', 'Dumbbell Decline Bench Press', 'Machine Chest Press', 'Machine Incline Chest Press', 'Machine Decline Chest Press', 'Cable Chest Press', 'Cable Incline Chest Press', 'Cable Decline Chest Press', 'Dumbbell Flat Flyes', 'Dumbbell Incline Flyes', 'Dumbbell Decline Flyes', 'Cable Crossover High to Low', 'Cable Crossover Low to High', 'Cable Crossover Middle', 'Pec Deck Machine', 'Chest Dips', 'Push-Ups', 'Incline Push-Ups', 'Decline Push-Ups', 'Diamond Push-Ups', 'Wide Grip Push-Ups', 'Barbell Floor Press', 'Dumbbell Floor Press', 'Resistance Band Chest Press', 'Smith Machine Flat Bench Press', 'Smith Machine Incline Bench Press', 'Smith Machine Decline Bench Press', 'Dumbbell Pullover', 'Barbell Pullover', 'Cable Pullover', 'Single-Arm Dumbbell Press', 'Single-Arm Cable Press', 'Squeeze Press', 'Hex Press'],
          'Back': ['Barbell Row', 'Dumbbell Row', 'Cable Row', 'Machine Row', 'T-Bar Row', 'Pendlay Row', 'Yates Row', 'Seated Cable Row Wide Grip', 'Seated Cable Row Close Grip', 'Seated Cable Row Neutral Grip', 'Pull-Ups Wide Grip', 'Pull-Ups Close Grip', 'Pull-Ups Neutral Grip', 'Chin-Ups', 'Lat Pulldown Wide Grip', 'Lat Pulldown Close Grip', 'Lat Pulldown Neutral Grip', 'Lat Pulldown Reverse Grip', 'Single-Arm Dumbbell Row', 'Single-Arm Cable Row', 'Barbell Deadlift', 'Dumbbell Deadlift', 'Trap Bar Deadlift', 'Romanian Deadlift Barbell', 'Romanian Deadlift Dumbbell', 'Rack Pull', 'Cable Face Pull', 'Dumbbell Face Pull', 'Straight-Arm Pulldown', 'Resistance Band Rows', 'Kettlebell Row', 'Inverted Row', 'Renegade Row', 'Good Morning Barbell', 'Good Morning Dumbbell', 'Superman Hold', 'Reverse Fly Dumbbell', 'Reverse Fly Cable', 'Reverse Fly Machine', 'Barbell Shrug', 'Dumbbell Shrug', 'Cable Shrug', 'Machine Shrug'],
          'Shoulders': ['Barbell Overhead Press', 'Dumbbell Overhead Press', 'Machine Shoulder Press', 'Cable Shoulder Press', 'Smith Machine Shoulder Press', 'Barbell Behind Neck Press', 'Dumbbell Arnold Press', 'Single-Arm Dumbbell Press', 'Single-Arm Cable Press', 'Seated Barbell Press', 'Seated Dumbbell Press', 'Standing Barbell Military Press', 'Dumbbell Lateral Raise', 'Cable Lateral Raise', 'Machine Lateral Raise', 'Dumbbell Front Raise', 'Barbell Front Raise', 'Cable Front Raise', 'Plate Front Raise', 'Dumbbell Rear Delt Fly', 'Cable Rear Delt Fly', 'Machine Rear Delt Fly', 'Reverse Pec Deck', 'Barbell Upright Row', 'Dumbbell Upright Row', 'Cable Upright Row', 'Cable Face Pull', 'Band Pull Apart', 'Pike Push-Up', 'Handstand Push-Up', 'Dumbbell Around the World'],
          'Biceps': ['Barbell Curl', 'EZ Bar Curl', 'Dumbbell Curl', 'Cable Curl', 'Machine Curl', 'Hammer Curl Dumbbell', 'Hammer Curl Cable', 'Concentration Curl', 'Preacher Curl Barbell', 'Preacher Curl EZ Bar', 'Preacher Curl Dumbbell', 'Preacher Curl Machine', 'Preacher Curl Cable', 'Incline Dumbbell Curl', 'Seated Dumbbell Curl', 'Standing Dumbbell Curl', 'Standing Barbell Curl', 'Cable Curl Rope', 'Cable Curl Bar', 'Single-Arm Cable Curl', 'Spider Curl Barbell', 'Spider Curl Dumbbell', 'Spider Curl EZ Bar', 'Zottman Curl', 'Reverse Curl Barbell', 'Reverse Curl EZ Bar', 'Reverse Curl Dumbbell', 'Drag Curl', 'Cross-Body Hammer Curl', '21s', 'Resistance Band Curl', 'Chin-Up', 'Seated Alternating Curl'],
          'Triceps': ['Barbell Close-Grip Bench Press', 'Dumbbell Close-Grip Bench Press', 'Smith Machine Close-Grip Bench Press', 'Tricep Dips', 'Bench Dips', 'Parallel Bar Dips', 'Barbell Skull Crushers', 'Dumbbell Skull Crushers', 'EZ Bar Skull Crushers', 'Cable Skull Crushers', 'Overhead Dumbbell Extension', 'Overhead Barbell Extension', 'Overhead Cable Extension', 'Cable Rope Pushdown', 'Cable Bar Pushdown', 'Cable Reverse Grip Pushdown', 'Cable Single-Arm Pushdown', 'Machine Tricep Extension', 'Dumbbell Kickbacks', 'Cable Kickbacks', 'Diamond Push-Ups', 'Close-Grip Push-Ups', 'Dumbbell Floor Press', 'Lying Dumbbell Extension', 'Lying Barbell Extension', 'Resistance Band Pushdown', 'Bodyweight Tricep Extension', 'Dumbbell Tate Press', 'Single-Arm Overhead Extension'],
          'Legs': ['Barbell Back Squat', 'Barbell Front Squat', 'Dumbbell Squat', 'Goblet Squat', 'Smith Machine Squat', 'Hack Squat Machine', 'Leg Press', 'V-Squats', 'Sissy Squat', 'Barbell Lunges', 'Dumbbell Lunges', 'Walking Lunge Barbell', 'Walking Lunge Dumbbell', 'Reverse Lunge Barbell', 'Reverse Lunge Dumbbell', 'Side Lunge', 'Bulgarian Split Squat Barbell', 'Bulgarian Split Squat Dumbbell', 'Step-Ups Barbell', 'Step-Ups Dumbbell', 'Leg Extension Machine', 'Leg Curl Machine Lying', 'Leg Curl Machine Seated', 'Barbell Romanian Deadlift', 'Dumbbell Romanian Deadlift', 'Barbell Sumo Deadlift', 'Dumbbell Sumo Deadlift', 'Single-Leg Deadlift Barbell', 'Single-Leg Deadlift Dumbbell', 'Glute Bridge Barbell', 'Glute Bridge Dumbbell', 'Glute Bridge Bodyweight', 'Hip Thrust Barbell', 'Hip Thrust Dumbbell', 'Hip Thrust Machine', 'Wall Sit', 'Box Jump', 'Standing Calf Raise Machine', 'Standing Calf Raise Barbell', 'Standing Calf Raise Dumbbell', 'Seated Calf Raise Machine', 'Donkey Calf Raise', 'Single-Leg Calf Raise', 'Calf Press on Leg Press', 'Smith Machine Calf Raise', 'Jump Rope Calves', 'Farmer\'s Walk on Toes', 'Tib Raises', 'Calf Raise Hold', 'Explosive Calf Jumps'],
          'Forearms': ['Barbell Wrist Curl', 'Dumbbell Wrist Curl', 'Cable Wrist Curl', 'Barbell Reverse Wrist Curl', 'Dumbbell Reverse Wrist Curl', 'Cable Reverse Wrist Curl', 'Behind-the-Back Wrist Curl', 'Farmer\'s Carry Dumbbell', 'Farmer\'s Carry Barbell', 'Farmer\'s Carry Kettlebell', 'Plate Pinch Hold', 'Towel Pull-Up', 'Dead Hang', 'Barbell Hold', 'Dumbbell Hold', 'Hex Dumbbell Hold', 'Hammer Curl', 'Reverse Curl Barbell', 'Reverse Curl Dumbbell', 'Reverse Curl Cable', 'Zottman Curl', 'Finger Curl', 'Rope Climb', 'Wrist Roller', 'Grip Trainer Squeeze', 'Towel Squeeze', 'Rice Bucket Drill'],
          'Core': ['Plank', 'Side Plank', 'Weighted Plank', 'Plank to Push-Up', 'Crunches', 'Bicycle Crunch', 'Cable Crunch', 'Machine Crunch', 'Weighted Crunch', 'Russian Twist Bodyweight', 'Russian Twist Dumbbell', 'Russian Twist Medicine Ball', 'Cable Russian Twist', 'Leg Raise', 'Hanging Leg Raise', 'Captain\'s Chair Leg Raise', 'Ab Wheel Rollout', 'Barbell Rollout', 'Mountain Climber', 'Dead Bug', 'Bird Dog', 'Pallof Press Cable', 'Cable Woodchoppers High to Low', 'Cable Woodchoppers Low to High', 'Toe Touch', 'V-Up', 'Hollow Body Hold', 'Dragon Flag', 'L-Sit', 'Farmer\'s Walk', 'Overhead Farmer\'s Walk'],
          'Abs': ['Crunches', 'Reverse Crunch', 'Weighted Sit-Up', 'Decline Sit-Up', 'Sit-Ups', 'Cable Crunch', 'Machine Crunch', 'Leg Raise', 'Hanging Leg Raise', 'Plank', 'Side Plank', 'Bicycle Crunch', 'Russian Twist', 'Mountain Climber', 'Flutter Kick', 'Scissor Kicks', 'V-Up', 'Ab Wheel Rollout', 'Toe Touch', 'Jackknife', 'Side Bend Cable', 'Side Bend Dumbbell', 'Stability Ball Crunch', 'Dead Bug', 'Oblique Crunch'],
          'Glutes': ['Barbell Hip Thrust', 'Dumbbell Hip Thrust', 'Smith Machine Hip Thrust', 'Machine Hip Thrust', 'Barbell Glute Bridge', 'Dumbbell Glute Bridge', 'Single-Leg Glute Bridge', 'Cable Kickbacks', 'Machine Kickbacks', 'Bulgarian Split Squat', 'Barbell Sumo Deadlift', 'Dumbbell Sumo Deadlift', 'Step-ups Barbell', 'Step-ups Dumbbell', 'Romanian Deadlift', 'Cable Pull Through', 'Frog Pumps', 'Donkey Kicks'],
          'Cardio': ['Treadmill Walking', 'Treadmill Running', 'Treadmill Jogging', 'Treadmill Incline Walk', 'Treadmill Sprints', 'Cycling Stationary Bike', 'Cycling Spin Bike', 'Cycling Recumbent Bike', 'Elliptical', 'Rowing Machine', 'Stair Climber', 'StairMaster', 'Jump Rope', 'Burpees', 'Mountain Climbers', 'High Knees', 'Butt Kicks', 'Jumping Jacks', 'Box Jumps', 'Battle Ropes', 'Assault Bike', 'Ski Erg', 'Swimming', 'Running Outdoor', 'Cycling Outdoor', 'Walking Outdoor', 'Hiking', 'HIIT Circuit', 'Tabata', 'Boxing', 'Kickboxing', 'Shadow Boxing'],
          'Full Body': ['Burpees', 'Barbell Thrusters', 'Dumbbell Thrusters', 'Barbell Clean and Press', 'Dumbbell Clean and Press', 'Kettlebell Clean and Press', 'Turkish Get-ups', 'Battle Ropes', 'Sled Push', 'Sled Pull', 'Farmers Walk', 'Man Makers', 'Devil Press']
        };

        const motivationalQuotes = [
            "The only bad workout is the one that didn't happen!",
            "Discipline is doing what needs to be done!",
            "You don't have to be great to start, but you have to start to be great!",
            "Success is what comes after you stop making excuses!",
            "The pain you feel today will be the strength you feel tomorrow!",
            "Don't wish for it, work for it!",
            "Your body can stand almost anything. It's your mind you have to convince!",
            "The only person you should try to be better than is the person you were yesterday!"
        ];

        // Main App Component
        function GymScheduler() {
          const [workouts, setWorkouts] = useState([]);
          const [showForm, setShowForm] = useState(false);
          const [date, setDate] = useState('');
          const [bodyParts, setBodyParts] = useState([{ bodyPart: '', exercises: [''] }]);
          const [minDate, setMinDate] = useState('');
          const [showActuals, setShowActuals] = useState(null);

          useEffect(() => {
            // Set minimum date to today
            const today = new Date();
            const formattedDate = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            setMinDate(formattedDate);
            
            // Load saved workouts from localStorage
            const savedWorkouts = localStorage.getItem('gymWorkouts');
            if (savedWorkouts) {
              try {
                setWorkouts(JSON.parse(savedWorkouts));
              } catch (e) {
                console.error('Error loading workouts:', e);
              }
            }
          }, []);

          // Save workouts to localStorage whenever they change
          useEffect(() => {
            if (workouts.length >= 0) {
              localStorage.setItem('gymWorkouts', JSON.stringify(workouts));
            }
          }, [workouts]);

          const formatDate = (dateString) => {
            const date = new Date(dateString + 'T00:00:00');
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            return `${days[date.getDay()]}, ${months[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`;
          };

          const downloadICS = (workout) => {
            try {
              // Create date objects at 7:00 AM - 8:00 AM local time
              const workoutDate = new Date(workout.date + 'T07:00:00');
              const startDate = new Date(workoutDate);
              const endDate = new Date(workoutDate);
              endDate.setHours(8, 0, 0, 0);
              
              const formatICSDate = (date) => {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const hours = String(date.getHours()).padStart(2, '0');
                const minutes = String(date.getMinutes()).padStart(2, '0');
                const seconds = String(date.getSeconds()).padStart(2, '0');
                return `${year}${month}${day}T${hours}${minutes}${seconds}`;
              };

              // Get timezone
              const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;

              let description = 'PLANNED WORKOUT:\\n\\n';
              workout.bodyParts.forEach(bp => {
                description += `${bp.bodyPart}:\\n`;
                bp.exercises.forEach(ex => {
                  description += `- ${ex}\\n`;
                });
                description += '\\n';
              });

              if (workout.actual && workout.actual.went === true && workout.actual.data) {
                description += 'ACTUAL WORKOUT:\\n\\n';
                workout.actual.data.forEach(bp => {
                  description += `${bp.bodyPart}:\\n`;
                  bp.exercises.forEach(ex => {
                    description += `- ${ex.exercise} (${ex.weight === 'NA' ? 'N/A' : ex.weight + 'kg'})\\n`;
                  });
                  description += '\\n';
                });
              } else if (workout.actual && workout.actual.went === false) {
                description += 'ACTUAL WORKOUT:\\n\\nDid not attend gym on this day.';
              }

              const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Gym Scheduler App//EN
CALSCALE:GREGORIAN
METHOD:PUBLISH
BEGIN:VTIMEZONE
TZID:${timeZone}
END:VTIMEZONE
BEGIN:VEVENT
UID:${workout.id}@gym-scheduler-app
DTSTAMP:${formatICSDate(new Date())}
DTSTART;TZID=${timeZone}:${formatICSDate(startDate)}
DTEND;TZID=${timeZone}:${formatICSDate(endDate)}
SUMMARY:${workout.bodyParts.map(bp => bp.bodyPart).join(' + ')} Workout
DESCRIPTION:${description.replace(/\n/g, '\\n')}
STATUS:CONFIRMED
SEQUENCE:0
BEGIN:VALARM
TRIGGER:-PT1H
ACTION:DISPLAY
DESCRIPTION:Workout in 1 hour
END:VALARM
END:VEVENT
END:VCALENDAR`;

              const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
              
              // Check if running on mobile and Web Share API is available
              const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
              
              if (isMobile && navigator.share) {
                const file = new File([blob], `workout-${workout.date}.ics`, { 
                  type: 'text/calendar' 
                });
                
                navigator.share({
                  files: [file],
                  title: 'Gym Workout Calendar Event',
                  text: `Add ${workout.bodyParts.map(bp => bp.bodyPart).join(' + ')} workout to your calendar`
                }).then(() => {
                  console.log('Shared successfully');
                }).catch((error) => {
                  console.log('Share cancelled or failed:', error);
                  fallbackDownload(blob, workout.date);
                });
              } else {
                fallbackDownload(blob, workout.date);
              }
            } catch (error) {
              console.error('Download error:', error);
              alert('‚ùå Failed to create calendar file. Please try again.');
            }
          };

          const fallbackDownload = (blob, date) => {
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `gym-workout-${date}.ics`;
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            
            setTimeout(() => {
              document.body.removeChild(link);
              URL.revokeObjectURL(url);
            }, 100);
          };

          const handleSavePlan = () => {
            // Validate input
            const validBodyParts = bodyParts.filter(bp => 
              bp.bodyPart && bp.exercises.some(e => e.trim())
            );

            if (!date) {
              alert('Please select a date');
              return;
            }

            if (validBodyParts.length === 0) {
              alert('Please add at least one body part with exercises');
              return;
            }

            // Create workout object
            const workoutData = {
              id: Date.now(),
              date,
              bodyParts: validBodyParts.map(bp => ({
                bodyPart: bp.bodyPart,
                exercises: bp.exercises.filter(e => e.trim())
              })),
              actual: null
            };

            // Add to workouts and sort by date
            const updatedWorkouts = [...workouts, workoutData].sort((a, b) => 
              new Date(a.date) - new Date(b.date)
            );
            
            setWorkouts(updatedWorkouts);
            
            // Reset form
            setDate('');
            setBodyParts([{ bodyPart: '', exercises: [''] }]);
            setShowForm(false);
            
            alert('‚úÖ Workout plan saved successfully!');
          };

          const deleteWorkout = (id) => {
            if (confirm('Are you sure you want to delete this workout?')) {
              setWorkouts(workouts.filter(w => w.id !== id));
              alert('Workout deleted successfully');
            }
          };

          // Check if form has valid data
          const hasValidPlanData = () => {
            if (!date) return false;
            return bodyParts.some(bp => 
              bp.bodyPart && bp.exercises.some(e => e.trim())
            );
          };

          // Body Part Management
          const addBodyPart = () => {
            setBodyParts([...bodyParts, { bodyPart: '', exercises: [''] }]);
          };

          const removeBodyPart = (index) => {
            if (bodyParts.length > 1) {
              setBodyParts(bodyParts.filter((_, i) => i !== index));
            } else {
              alert('You must have at least one body part');
            }
          };

          const updateBodyPart = (index, value) => {
            const newBodyParts = [...bodyParts];
            newBodyParts[index].bodyPart = value;
            newBodyParts[index].exercises = [''];
            setBodyParts(newBodyParts);
          };

          // Exercise Management
          const addExercise = (bpIndex) => {
            const newBodyParts = [...bodyParts];
            newBodyParts[bpIndex].exercises.push('');
            setBodyParts(newBodyParts);
          };

          const removeExercise = (bpIndex, exIndex) => {
            const newBodyParts = [...bodyParts];
            if (newBodyParts[bpIndex].exercises.length > 1) {
              newBodyParts[bpIndex].exercises = newBodyParts[bpIndex].exercises.filter((_, i) => i !== exIndex);
              setBodyParts(newBodyParts);
            } else {
              alert('You must have at least one exercise');
            }
          };

          const updateExercise = (bpIndex, exIndex, value) => {
            const newBodyParts = [...bodyParts];
            newBodyParts[bpIndex].exercises[exIndex] = value;
            setBodyParts(newBodyParts);
          };

          return (
            <div className="min-h-screen bg-black p-4 safe-top">
              <div className="max-w-4xl mx-auto">
                {/* Header */}
                <div className="bg-gray-900 rounded-2xl p-6 mb-6 border border-gray-800 shadow-xl">
                  <div className="flex flex-col items-center gap-4">
                    <div className="flex items-center gap-3">
                      <Dumbbell />
                      <h1 className="text-3xl md:text-4xl font-bold text-white">Gym Scheduler</h1>
                    </div>
                    
                    <button 
                      onClick={() => setShowForm(!showForm)}
                      className="w-full bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold flex items-center justify-center gap-2"
                    >
                      <Plus />
                      <span>Add New Workout</span>
                    </button>
                  </div>
                </div>

                {/* Add Workout Form */}
                {showForm && (
                  <div className="bg-gray-900 rounded-2xl p-6 mb-6 border border-gray-800 shadow-xl">
                    <div className="flex justify-between items-center mb-6">
                      <h2 className="text-2xl font-bold text-white">Schedule New Workout</h2>
                      <button 
                        onClick={() => {
                          setShowForm(false);
                          setDate('');
                          setBodyParts([{ bodyPart: '', exercises: [''] }]);
                        }}
                        className="text-gray-400 hover:text-white transition-colors"
                      >
                        <XCircle />
                      </button>
                    </div>
                    
                    <div className="space-y-6">
                      {/* Date Picker */}
                      <div>
                        <label className="block text-gray-300 mb-2 text-sm font-semibold">
                          üìÖ Workout Date
                        </label>
                        <input 
                          type="date" 
                          value={date} 
                          onChange={(e) => setDate(e.target.value)} 
                          min={minDate}
                          className="w-full bg-gray-800 text-white border border-gray-700 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        />
                      </div>

                      {/* Body Parts */}
                      {bodyParts.map((bp, bpIndex) => (
                        <div key={bpIndex} className="border-2 border-gray-700 rounded-xl p-5 bg-gray-800/50">
                          <div className="flex justify-between items-center mb-4">
                            <label className="text-white text-lg font-semibold">
                              üí™ Body Part {bpIndex + 1}
                            </label>
                            {bodyParts.length > 1 && (
                              <button 
                                onClick={() => removeBodyPart(bpIndex)}
                                className="text-red-400 hover:text-red-300 transition-colors"
                              >
                                <Trash2 />
                              </button>
                            )}
                          </div>
                          
                          <select 
                            value={bp.bodyPart} 
                            onChange={(e) => updateBodyPart(bpIndex, e.target.value)}
                            className="w-full bg-gray-700 text-white border border-gray-600 rounded-lg px-4 py-3 mb-4 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                          >
                            <option value="">Select Body Part...</option>
                            {Object.keys(bodyPartExercises).map(bodyPart => (
                              <option key={bodyPart} value={bodyPart}>{bodyPart}</option>
                            ))}
                          </select>

                          {/* Exercises */}
                          <div className="space-y-3">
                            <label className="block text-gray-400 text-sm font-semibold">
                              Exercises
                            </label>
                            {bp.exercises.map((ex, exIndex) => (
                              <div key={exIndex} className="flex gap-2">
                                <select 
                                  value={ex} 
                                  onChange={(e) => updateExercise(bpIndex, exIndex, e.target.value)}
                                  disabled={!bp.bodyPart}
                                  className="flex-1 bg-gray-700 text-white border border-gray-600 rounded-lg px-4 py-2 disabled:opacity-50 disabled:cursor-not-allowed focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                >
                                  <option value="">Select Exercise...</option>
                                  {bp.bodyPart && bodyPartExercises[bp.bodyPart]?.map(exercise => {
                                    const isSelected = bp.exercises.includes(exercise) && bp.exercises[exIndex] !== exercise;
                                    return (
                                      <option 
                                        key={exercise} 
                                        value={exercise}
                                        disabled={isSelected}
                                        style={isSelected ? { color: '#666', backgroundColor: '#333' } : {}}
                                      >
                                        {exercise}
                                      </option>
                                    );
                                  })}
                                </select>
                                {bp.exercises.length > 1 && (
                                  <button 
                                    onClick={() => removeExercise(bpIndex, exIndex)}
                                    className="bg-red-600 hover:bg-red-700 text-white px-3 rounded-lg transition-colors"
                                  >
                                    <Trash2 />
                                  </button>
                                )}
                              </div>
                            ))}
                            <button 
                              onClick={() => addExercise(bpIndex)}
                              disabled={!bp.bodyPart}
                              className="text-blue-400 hover:text-blue-300 text-sm font-semibold disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                            >
                              + Add Exercise
                            </button>
                          </div>
                        </div>
                      ))}

                      {/* Add Body Part Button */}
                      <button 
                        onClick={addBodyPart}
                        className="w-full bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors"
                      >
                        + Add Another Body Part
                      </button>

                      {/* Action Buttons - Only show if form has valid data */}
                      {hasValidPlanData() && (
                        <div className="flex gap-3 pt-4 border-t border-gray-700">
                          <button 
                            onClick={handleSavePlan}
                            className="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors"
                          >
                            üíæ Save Plan
                          </button>
                          <button 
                            onClick={() => {
                              setShowForm(false);
                              setDate('');
                              setBodyParts([{ bodyPart: '', exercises: [''] }]);
                            }}
                            className="flex-1 bg-gray-700 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors"
                          >
                            Cancel
                          </button>
                        </div>
                      )}
                    </div>
                  </div>
                )}

                {/* Workouts List */}
                <div className="space-y-4 pb-8">
                  {workouts.length === 0 ? (
                    <div className="bg-gray-900 rounded-2xl p-12 text-center border border-gray-800">
                      <div className="flex justify-center mb-4">
                        <Dumbbell />
                      </div>
                      <h3 className="text-xl text-gray-400 mt-4">No workouts scheduled yet</h3>
                      <p className="text-gray-500 mt-2">Click "Add New Workout" to get started!</p>
                    </div>
                  ) : (
                    workouts.map(w => (
                      <div key={w.id} className="bg-gray-900 rounded-2xl p-6 border border-gray-800 shadow-xl">
                        {/* Workout Header */}
                        <div className="flex justify-between items-start mb-5">
                          <div className="flex items-center gap-3">
                            <Calendar />
                            <div>
                              <span className="text-white font-semibold text-lg block">
                                {formatDate(w.date)}
                              </span>
                              <span className="text-gray-500 text-xs">
                                7:00 AM - 8:00 AM
                              </span>
                            </div>
                          </div>
                          <div className="flex items-center gap-2">
                            {w.actual?.went === true && <CheckCircle />}
                            {w.actual?.went === false && <XCircle />}
                            <button 
                              onClick={() => deleteWorkout(w.id)}
                              className="text-red-400 hover:text-red-300 transition-colors"
                            >
                              <Trash2 />
                            </button>
                          </div>
                        </div>

                        {/* Planned Workout */}
                        <div className="mb-5">
                          <h3 className="text-lg font-bold text-blue-400 mb-3 flex items-center gap-2">
                            üìã Planned Workout
                          </h3>
                          <div className="space-y-3">
                            {w.bodyParts.map((bp, i) => (
                              <div key={i} className="bg-gray-800/70 rounded-lg p-4 border border-gray-700">
                                <p className="text-white font-bold mb-2 text-lg">
                                  üí™ {bp.bodyPart}
                                </p>
                                <ul className="space-y-1 pl-4">
                                  {bp.exercises.map((ex, j) => (
                                    <li key={j} className="text-gray-300 text-sm">
                                      ‚Ä¢ {ex}
                                    </li>
                                  ))}
                                </ul>
                              </div>
                            ))}
                          </div>
                        </div>

                        {/* Actual Workout */}
                        <div className="border-t border-gray-800 pt-5">
                          <h3 className="text-lg font-bold text-green-400 mb-3 flex items-center gap-2">
                            ‚úÖ Actual Workout
                          </h3>
                          
                          {!w.actual ? (
                            <div className="space-y-3">
                              <button 
                                onClick={() => setShowActuals(w)}
                                className="w-full bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors"
                              >
                                üìù Record Actuals
                              </button>
                            </div>
                          ) : w.actual.went === false ? (
                            <div className="space-y-3">
                              <div className="bg-red-900/20 border-2 border-red-700 rounded-lg p-4">
                                <p className="text-red-300 italic text-center">
                                  "{motivationalQuotes[Math.floor(Math.random() * motivationalQuotes.length)]}"
                                </p>
                              </div>
                              <button 
                                onClick={() => downloadICS(w)}
                                className="w-full bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-semibold flex items-center justify-center gap-2 transition-colors"
                              >
                                <Download />
                                Download Calendar File
                              </button>
                            </div>
                          ) : (
                            <div className="space-y-3">
                              <div className="space-y-3">
                                {w.actual.data?.map((bp, i) => (
                                  <div key={i} className="bg-green-900/20 border border-green-700 rounded-lg p-4">
                                    <p className="text-white font-bold mb-2">
                                      üí™ {bp.bodyPart}
                                    </p>
                                    <div className="space-y-1 pl-4">
                                      {bp.exercises.map((ex, j) => (
                                        <p key={j} className="text-gray-300 text-sm">
                                          ‚Ä¢ {ex.exercise} - <span className="text-green-400 font-semibold">{ex.weight === 'NA' ? 'N/A' : ex.weight + ' kg'}</span>
                                        </p>
                                      ))}
                                    </div>
                                  </div>
                                ))}
                              </div>
                              <button 
                                onClick={() => downloadICS(w)}
                                className="w-full bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-semibold flex items-center justify-center gap-2 transition-colors"
                              >
                                <Download />
                                Download Calendar File (Plan + Actuals)
                              </button>
                            </div>
                          )}
                        </div>
                      </div>
                    ))
                  )}
                </div>

                {/* Actuals Modal */}
                {showActuals && (
                  <ActualsModal 
                    workout={showActuals} 
                    onClose={() => setShowActuals(null)} 
                    onSave={(went, data) => {
                      const updatedWorkouts = workouts.map(w => 
                        w.id === showActuals.id 
                          ? { ...w, actual: { went, data } } 
                          : w
                      );
                      setWorkouts(updatedWorkouts);
                      
                      // Download consolidated ICS file with plan + actuals
                      const updatedWorkout = updatedWorkouts.find(w => w.id === showActuals.id);
                      if (updatedWorkout) {
                        downloadICS(updatedWorkout);
                      }
                      
                      setShowActuals(null);
                    }} 
                  />
                )}
              </div>
            </div>
          );
        }

        // Actuals Modal Component
        function ActualsModal({ workout, onClose, onSave }) {
          const [went, setWent] = useState('');
          const [bps, setBps] = useState([{ bodyPart: '', exercises: [{ exercise: '', weight: '', isNA: false }] }]);

          const copyFromPlan = () => {
            const copiedBps = workout.bodyParts.map(bp => ({
              bodyPart: bp.bodyPart,
              exercises: bp.exercises.map(ex => ({ exercise: ex, weight: '', isNA: false }))
            }));
            setBps(copiedBps);
            alert('‚úÖ Plan copied! Now fill in the weights or mark as N/A.');
          };

          const addBodyPart = () => {
            setBps([...bps, { bodyPart: '', exercises: [{ exercise: '', weight: '', isNA: false }] }]);
          };

          const removeBodyPart = (index) => {
            if (bps.length > 1) {
              setBps(bps.filter((_, i) => i !== index));
            }
          };

          const addExercise = (bpIndex) => {
            const newBps = [...bps];
            newBps[bpIndex].exercises.push({ exercise: '', weight: '', isNA: false });
            setBps(newBps);
          };

          const removeExercise = (bpIndex, exIndex) => {
            const newBps = [...bps];
            if (newBps[bpIndex].exercises.length > 1) {
              newBps[bpIndex].exercises = newBps[bpIndex].exercises.filter((_, i) => i !== exIndex);
              setBps(newBps);
            }
          };

          const updateBodyPart = (index, value) => {
            const newBps = [...bps];
            newBps[index].bodyPart = value;
            newBps[index].exercises = [{ exercise: '', weight: '', isNA: false }];
            setBps(newBps);
          };

          const updateExercise = (bpIndex, exIndex, field, value) => {
            const newBps = [...bps];
            if (field === 'isNA') {
              newBps[bpIndex].exercises[exIndex].isNA = value;
              if (value) {
                newBps[bpIndex].exercises[exIndex].weight = '';
              }
            } else {
              newBps[bpIndex].exercises[exIndex][field] = value;
            }
            setBps(newBps);
          };

          // Get all selected exercises for a body part to grey out duplicates
          const getSelectedExercises = (bpIndex) => {
            return bps[bpIndex].exercises.map(ex => ex.exercise).filter(e => e);
          };

          const handleDownloadCalendar = () => {
            if (!went) {
              alert('Please select if you went to the gym');
              return;
            }

            if (went === 'no') {
              onSave(false, null);
              return;
            }

            // Validate that all exercises have either weight or NA
            let hasInvalidExercise = false;
            let invalidExercises = [];

            bps.forEach(bp => {
              bp.exercises.forEach(ex => {
                if (ex.exercise && !ex.weight && !ex.isNA) {
                  hasInvalidExercise = true;
                  invalidExercises.push(ex.exercise);
                }
              });
            });

            if (hasInvalidExercise) {
              alert(`‚ùå Error: Please enter weight (kg) or mark as N/A for all exercises.\n\nMissing weight/N/A for:\n${invalidExercises.join('\n')}`);
              return;
            }

            const validData = bps
              .filter(b => b.bodyPart && b.exercises.some(e => e.exercise && (e.weight || e.isNA)))
              .map(b => ({
                bodyPart: b.bodyPart,
                exercises: b.exercises
                  .filter(e => e.exercise && (e.weight || e.isNA))
                  .map(e => ({
                    exercise: e.exercise,
                    weight: e.isNA ? 'NA' : e.weight
                  }))
              }));

            if (validData.length === 0) {
              alert('Please add at least one exercise with weight or N/A');
              return;
            }

            onSave(true, validData);
          };

          const formatDate = (dateString) => {
            const date = new Date(dateString + 'T00:00:00');
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            return {
              day: days[date.getDay()],
              date: `${months[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`
            };
          };

          const { day, date } = formatDate(workout.date);

          return (
            <div className="fixed inset-0 bg-black/90 flex items-center justify-center p-4 z-50 overflow-y-auto">
              <div className="bg-gray-900 rounded-2xl p-6 max-w-2xl w-full my-8 border border-gray-800 shadow-2xl max-h-[90vh] overflow-y-auto">
                <div className="flex justify-between items-center mb-6 sticky top-0 bg-gray-900 pb-4 border-b border-gray-800 z-10">
                  <h2 className="text-2xl font-bold text-white">Record Actual Workout</h2>
                  <button 
                    onClick={onClose}
                    className="text-gray-400 hover:text-white transition-colors"
                  >
                    <XCircle />
                  </button>
                </div>
                
                {/* Date Display */}
                <div className="mb-6 p-4 bg-gray-800 rounded-lg border border-gray-700">
                  <p className="text-gray-400 text-sm mb-1">Workout Date</p>
                  <p className="text-white font-semibold text-lg">{day}, {date}</p>
                  <p className="text-gray-500 text-xs mt-1">7:00 AM - 8:00 AM</p>
                </div>

                {/* Went to Gym */}
                <div className="mb-6">
                  <label className="block text-gray-300 mb-3 text-sm font-semibold">
                    Did you go to the gym?
                  </label>
                  <select 
                    value={went} 
                    onChange={(e) => setWent(e.target.value)}
                    className="w-full bg-gray-800 text-white border border-gray-700 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  >
                    <option value="">Select...</option>
                    <option value="yes">‚úÖ Yes, I went</option>
                    <option value="no">‚ùå No, I didn't go</option>
                  </select>
                </div>

                {/* Copy from Plan Button */}
                {went === 'yes' && (
                  <div className="bg-gradient-to-r from-purple-900/40 to-blue-900/40 border-2 border-purple-500 rounded-xl p-5 mb-6">
                    <button 
                      onClick={copyFromPlan}
                      className="w-full bg-purple-600 hover:bg-purple-700 text-white px-6 py-4 rounded-lg font-bold text-lg transition-colors"
                    >
                      üìã Same as Planned
                    </button>
                    <p className="text-purple-200 text-sm mt-3 text-center">
                      Click to auto-fill exercises from your plan!
                    </p>
                  </div>
                )}

                {/* Actual Exercises */}
                {went === 'yes' && (
                  <div className="space-y-5">
                    {bps.map((bp, bpI) => (
                      <div key={bpI} className="border-2 border-gray-700 rounded-xl p-5 bg-gray-800/50">
                        <div className="flex justify-between items-center mb-4">
                          <label className="text-white text-lg font-semibold">
                            üí™ Body Part {bpI + 1}
                          </label>
                          {bps.length > 1 && (
                            <button 
                              onClick={() => removeBodyPart(bpI)}
                              className="text-red-400 hover:text-red-300 transition-colors"
                            >
                              <Trash2 />
                            </button>
                          )}
                        </div>
                        
                        <select 
                          value={bp.bodyPart} 
                          onChange={(e) => updateBodyPart(bpI, e.target.value)}
                          className="w-full bg-gray-700 text-white border border-gray-600 rounded-lg px-4 py-3 mb-4 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                          <option value="">Select Body Part...</option>
                          {Object.keys(bodyPartExercises).map(b => (
                            <option key={b} value={b}>{b}</option>
                          ))}
                        </select>

                        <div className="space-y-3">
                          {bp.exercises.map((ex, exI) => {
                            const selectedExercises = getSelectedExercises(bpI);
                            return (
                              <div key={exI} className="space-y-2">
                                <div className="flex gap-2">
                                  <select 
                                    value={ex.exercise} 
                                    onChange={(e) => updateExercise(bpI, exI, 'exercise', e.target.value)}
                                    disabled={!bp.bodyPart}
                                    className="flex-1 bg-gray-700 text-white border border-gray-600 rounded-lg px-4 py-2 disabled:opacity-50 disabled:cursor-not-allowed focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                  >
                                    <option value="">Select Exercise...</option>
                                    {bp.bodyPart && bodyPartExercises[bp.bodyPart]?.map(exercise => {
                                      const isSelected = selectedExercises.includes(exercise) && ex.exercise !== exercise;
                                      return (
                                        <option 
                                          key={exercise} 
                                          value={exercise}
                                          disabled={isSelected}
                                          style={isSelected ? { color: '#666', backgroundColor: '#333' } : {}}
                                        >
                                          {exercise}
                                        </option>
                                      );
                                    })}
                                  </select>
                                  {bp.exercises.length > 1 && (
                                    <button 
                                      onClick={() => removeExercise(bpI, exI)}
                                      className="bg-red-600 hover:bg-red-700 text-white px-3 rounded-lg transition-colors"
                                    >
                                      <Trash2 />
                                    </button>
                                  )}
                                </div>
                                
                                {/* Weight or NA input */}
                                <div className="flex gap-2 items-center pl-4">
                                  <input 
                                    type="number" 
                                    placeholder="Weight (kg)" 
                                    value={ex.weight} 
                                    onChange={(e) => updateExercise(bpI, exI, 'weight', e.target.value)}
                                    disabled={ex.isNA}
                                    className="flex-1 bg-gray-700 text-white border border-gray-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed"
                                    min="0"
                                    step="0.5"
                                  />
                                  <label className="flex items-center gap-2 bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 cursor-pointer hover:bg-gray-600 transition-colors">
                                    <input 
                                      type="checkbox"
                                      checked={ex.isNA}
                                      onChange={(e) => updateExercise(bpI, exI, 'isNA', e.target.checked)}
                                      className="w-4 h-4 accent-blue-600"
                                    />
                                    <span className="text-white text-sm font-medium">N/A</span>
                                  </label>
                                </div>
                              </div>
                            );
                          })}
                          <button 
                            onClick={() => addExercise(bpI)}
                            disabled={!bp.bodyPart}
                            className="text-blue-400 hover:text-blue-300 text-sm font-semibold disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                          >
                            + Add Exercise
                          </button>
                        </div>
                      </div>
                    ))}
                    
                    <button 
                      onClick={addBodyPart}
                      className="w-full bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors"
                    >
                      + Add Another Body Part
                    </button>
                  </div>
                )}

                {/* Motivational Quote for No */}
                {went === 'no' && (
                  <div className="bg-red-900/20 border-2 border-red-700 rounded-lg p-6 mb-6">
                    <p className="text-red-300 italic text-center text-lg">
                      "{motivationalQuotes[Math.floor(Math.random() * motivationalQuotes.length)]}"
                    </p>
                  </div>
                )}

                {/* Download Calendar Button */}
                {went && (
                  <div className="flex gap-3 mt-6 pt-6 border-t border-gray-800 sticky bottom-0 bg-gray-900">
                    <button 
                      onClick={handleDownloadCalendar}
                      className="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors flex items-center justify-center gap-2"
                    >
                      <Download />
                      Download Calendar File (Plan + Actuals)
                    </button>
                    <button 
                      onClick={onClose}
                      className="flex-1 bg-gray-700 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors"
                    >
                      Cancel
                    </button>
                  </div>
                )}
              </div>
            </div>
          );
        }

        // Render App
        ReactDOM.render(<GymScheduler />, document.getElementById('root'));
    </script>
</body>
</html>
